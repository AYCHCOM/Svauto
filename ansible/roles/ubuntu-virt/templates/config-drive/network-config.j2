version: 2
ethernets:

{% for ethernet in vm.devices.ethernets %}

  {{ ethernet.name }}:
     addresses: [ {{ ethernet.addresses | join(", ") }} ]

{% if ethernet.gateway4 is defined %}
     gateway4: {{ ethernet.gateway4 }}
{% endif %}

{% if ethernet.nameservers is defined %}
     nameservers:
         search: [ {{ ethernet.nameservers.search | join(", ") }} ]
         addresses: [ {{ ethernet.nameservers.addresses | join(", ") }} ]
{% endif %}

{% endfor %}
